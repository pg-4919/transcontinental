<!DOCTYPE html>
<html>

<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background-color: black;
        }

        .terminal {
            padding: 25px;
            overflow-y: scroll;
            overflow-x: hidden;
            overflow-wrap: anywhere;
            height: 100%;
            width: 70%;
            background-color: black;
            color: white;
        }
    </style>
</head>

<body>
    <div class="terminal" id="terminal" style="font-family: 'Press Start 2P'">
    </div>
    </div>
    <script>
        const dialogues = {
            opening: {
                confirm: false,
                text: "THE TRANSCONTINENTAL RAILROAD<br><br>You may:<br><br>&ensp; 1. Build the railroad<br>&ensp; 2. Learn about the railroad<br><br>What is your choice? ",
                process: input => ([ "build", "learn" ])[parseInt(input) - 1],
                valid: char => (char.match(/[1-2]/i) && currentInput.length == 0)
            },
            build: {
                text: "Ok boomer",
                valid: char => true
            },
            learn: {
                confirm: true,
                text: "The year is 1863, and the country is in shambles. The Civil War rages between the North and the South. Despite this, dreams of uniting the East and West move the Central Pacific and Union Pacific Railroad Companies to begin construction on a great Transcontinental Railroad. For seven years, they would forge forward from Sacramento and Omaha to meet at Promontory, Utah.<br><br>Press ENTER to continue.",
                process: input => "opening",
                valid: char => true
            }
        }

        const terminal = document.getElementById("terminal");
        let currentDialogue = "opening";
        let currentInput = "";

        function updateTerminal() {
            console.log(dialogues[currentDialogue].text + currentInput + "_");
            terminal.innerHTML = dialogues[currentDialogue].text + currentInput + "_";
        }

        function addChar(char) {
            if (!dialogues[currentDialogue].valid(currentInput + char)) return;
            else currentInput += char;
            updateTerminal();
        }

        function deleteChar() {
            if (currentInput.length > 0) currentInput = currentInput.slice(0, -1);
            updateTerminal();
        }

        function processInput() {
            if (currentInput === "" && !dialogues[currentDialogue].confirm) return;
            currentDialogue = dialogues[currentDialogue].process(currentInput);
            currentInput = "";
            updateTerminal();
        }

        document.addEventListener("keydown", event => {
            let char = String.fromCharCode(event.keyCode);
            console.log(event.keyCode);
            
            if (event.keyCode === 8) return deleteChar();
            if (event.keyCode === 13) return processInput();
            if (!char.match(/[A-Z|0-9]/i)) return;
            if (!event.shiftKey) char = char.toLowerCase();
            
            addChar(char);
        });

        window.addEventListener("load", () => {
            console.log("READY!");
            updateTerminal();
        });
    </script>
</body>

</html>
